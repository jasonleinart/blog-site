{% comment %}
<!--
Using `preload` so that page rendering doesn't get blocked.
Fill in `href`. You may have to adjust `as` and `onload`/`rel`, depending on content.
-->
<link href="<path/to/content.css>" rel="preload" as="style" onload="this.rel='stylesheet'">

<!--
Fallback in case JavaScript isn't enabled.
Fill in `href`. You may have to adjust `rel`.
-->
<noscript><link href="<path/to/content.css>" rel="stylesheet"></noscript>
{% endcomment %}

<!-- Custom Favicon - Let the theme handle favicon links via config -->

<!-- Google Analytics 4 (GA4) -->
{% if site.google_analytics_ga4 %}
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics_ga4 }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  
  {% if site.hydejack.cookies_banner %}
    // Check for cookie consent
    if (document.cookie.indexOf("hy--cookies-ok=true") > -1 || navigator.CookiesOK) {
      gtag('js', new Date());
      gtag('config', '{{ site.google_analytics_ga4 }}');
    } else {
      // Initialize without cookies until consent is given
      gtag('js', new Date());
      gtag('config', '{{ site.google_analytics_ga4 }}', {
        'anonymize_ip': true,
        'allow_google_signals': false,
        'allow_ad_personalization_signals': false
      });
    }
    
    // Listen for cookie consent
    document.addEventListener('hy--cookies-ok', function() {
      gtag('config', '{{ site.google_analytics_ga4 }}', {
        'anonymize_ip': false,
        'allow_google_signals': true,
        'allow_ad_personalization_signals': true
      });
    });
  {% else %}
    gtag('js', new Date());
    gtag('config', '{{ site.google_analytics_ga4 }}');
  {% endif %}
</script>
{% endif %}

<!-- Open external links in new tab -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Function to process external links
  function processExternalLinks() {
    document.querySelectorAll('a[href]').forEach(a => {
      // Check if it's an external link (starts with http/https and doesn't include current hostname)
      if ((a.href.startsWith('http://') || a.href.startsWith('https://')) && 
          !a.href.includes(location.hostname)) {
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
      }
    });
  }
  
  // Process links immediately
  processExternalLinks();
  
  // Also process links that might be added dynamically
  const observer = new MutationObserver(() => {
    processExternalLinks();
  });
  
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });
});
</script>
